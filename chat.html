<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Page de pubs avec r√©actions et messages priv√©s</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 20px auto;
    background: #f7f9fc;
    color: #222;
  }
  h1 {
    text-align: center;
    color: #1877f2;
  }
  form {
    margin-bottom: 20px;
  }
  textarea {
    width: 100%;
    height: 60px;
    resize: vertical;
    padding: 8px;
    font-size: 14px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  button {
    background: #1877f2;
    color: white;
    border: none;
    padding: 10px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
  }
  button:hover {
    background: #145dbf;
  }
  .pub {
    background: white;
    padding: 12px 16px;
    border-radius: 12px;
    margin-bottom: 15px;
    box-shadow: 0 3px 8px rgba(24, 119, 242, 0.15);
  }
  .pub-header {
    font-weight: bold;
    margin-bottom: 8px;
    color: #1877f2;
  }
  .pub-text {
    margin-bottom: 10px;
    font-size: 15px;
  }
  .actions button {
    margin-right: 12px;
    font-size: 14px;
  }
  .messages {
    margin-top: 10px;
    border-top: 1px solid #eee;
    padding-top: 10px;
  }
  .message {
    font-size: 13px;
    background: #e9f0fe;
    padding: 6px 10px;
    border-radius: 8px;
    margin-bottom: 6px;
  }
  .message strong {
    color: #145dbf;
  }
</style>
</head>
<body>

<h1>Publier et r√©agir</h1>

<form id="pubForm">
  <textarea id="pubInput" placeholder="√âcrivez votre pub ici..." required></textarea><br/>
  <button type="submit">Publier</button>
</form>

<div id="pubsContainer"></div>

<script>
// Simulate current user (auteur)
const currentUser = { id: 'user123', name: 'Jean Dupont' };

// Liste des pubs stock√©es en m√©moire
const pubs = [];

// Affiche toutes les pubs
function renderPubs() {
  const container = document.getElementById('pubsContainer');
  container.innerHTML = '';

  pubs.forEach(pub => {
    const pubDiv = document.createElement('div');
    pubDiv.className = 'pub';

    // Texte des r√©actions (nombre)
    const likes = pub.reactions.like || 0;

    pubDiv.innerHTML = `
      <div class="pub-header">${pub.authorName}</div>
      <div class="pub-text">${escapeHtml(pub.text)}</div>
      <div class="actions">
        <button onclick="reactToPub('${pub.id}', 'like')">üëç Like (${likes})</button>
        <button onclick="openCommentForm('${pub.id}')">Commenter (message priv√©)</button>
      </div>
      <div class="messages" id="messages-${pub.id}">
        ${pub.messages.map(m => `<div class="message"><strong>${escapeHtml(m.from)}:</strong> ${escapeHtml(m.text)}</div>`).join('')}
      </div>
    `;

    container.appendChild(pubDiv);
  });
}

// √âchapper HTML pour s√©curit√©
function escapeHtml(text) {
  if (!text) return '';
  return text.replace(/[&<>"']/g, function(m) {
    return {'&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'": '&#39;'}[m];
  });
}

// G√©rer la publication d'une nouvelle pub
document.getElementById('pubForm').addEventListener('submit', e => {
  e.preventDefault();
  const text = document.getElementById('pubInput').value.trim();
  if (!text) return alert("Veuillez √©crire quelque chose.");

  // Cr√©er un nouvel objet pub
  const newPub = {
    id: 'pub' + Date.now(),
    authorId: currentUser.id,
    authorName: currentUser.name,
    text: text,
    reactions: { like: 0 },
    messages: []
  };
  pubs.unshift(newPub); // ajouter au d√©but
  document.getElementById('pubInput').value = '';
  renderPubs();
});

// Ajouter une r√©action
function reactToPub(pubId, reaction) {
  const pub = pubs.find(p => p.id === pubId);
  if (!pub) return alert('Pub non trouv√©e.');

  if (!pub.reactions[reaction]) pub.reactions[reaction] = 0;
  pub.reactions[reaction]++;
  renderPubs();
}

// Ouvrir formulaire commentaire (message priv√©)
function openCommentForm(pubId) {
  const message = prompt("Envoyez un message priv√© √† l'auteur de la pub :");
  if (!message) return;

  const pub = pubs.find(p => p.id === pubId);
  if (!pub) return alert('Pub non trouv√©e.');

  // Ajouter message dans la pub, uniquement visible par l'auteur (simul√© ici)
  pub.messages.push({
    from: currentUser.name,
    text: message
  });

  alert("Message priv√© envoy√© √† " + pub.authorName + ".");
  renderPubs();
}

// Initial render
renderPubs();
</script>

</body>
</html>
