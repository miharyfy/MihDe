<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>IA Desktop Minimal</title>
<style>
  html, body {
    margin: 0;
    height: 100%;
    width: 100%;
    background-color: #2196F3; /* fond manga */
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: sans-serif;
  }

  .face {
    position: relative;
    width: 250px;   /* kely sy mazava */
    height: 250px;
  }

  /* maso outline fotsiny, transparent anatiny */
  .eye {
    position: absolute;
    width: 40px;
    height: 40px;
    border: 4px solid white; /* sisiny fotsy */
    border-radius: 50%;
    top: 60px;
    animation: blink 4s infinite;
  }
  .eye.left { left: 50px; }
  .eye.right { right: 50px; }

  /* vava tsipika fotsy */
  .mouth {
    position: absolute;
    width: 90px;
    height: 6px;
    background: white;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    border-radius: 5px;
    animation: talk 1s infinite;
    animation-play-state: paused;
  }

  @keyframes talk {
    0%,100% { height: 6px; }
    50% { height: 20px; } /* mitsika */
  }

  @keyframes blink {
    0%,90%,100% { border-width: 4px; }
    95% { border-width: 0px; }
  }
</style>
</head>
<body>
<div class="face">
  <div class="eye left"></div>
  <div class="eye right"></div>
  <div class="mouth"></div>
</div>

<script>
const API_KEY = "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"; // Apetraho eto ny API key-nao

// Mihaino avy hatrany
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const recognition = new SpeechRecognition();
recognition.lang = 'fr-FR';
recognition.continuous = true;

recognition.onresult = async function(event) {
    const transcript = event.results[event.results.length - 1][0].transcript;
    console.log("User said:", transcript);
    const reply = await callOpenAI(transcript);
    speakAI(reply);
};

recognition.start();

// OpenAI API
async function callOpenAI(text) {
    try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + API_KEY
            },
            body: JSON.stringify({
                model: "gpt-3.5-turbo",
                messages: [
                    { role: "system", content: "You are a friendly assistant." },
                    { role: "user", content: text }
                ]
            })
        });
        const data = await response.json();
        return data.choices[0].message.content;
    } catch (err) {
        console.error(err);
        return "Je ne peux pas te rÃ©pondre.";
    }
}

// TTS + vava mitsika
function speakAI(text) {
    const utter = new SpeechSynthesisUtterance(text);
    const mouth = document.querySelector('.mouth');
    mouth.style.animationPlayState = 'running';
    utter.onend = () => {
        mouth.style.animationPlayState = 'paused';
    };
    speechSynthesis.speak(utter);
}
</script>
</body>
</html>
