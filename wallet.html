<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Wallet - Portefeuille Crypto</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body {
    margin:0; padding:0;
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg,#1877f2,#6ea0f8);
    display:flex; justify-content:center; align-items:center; min-height:100vh;
}
.container {
    background:white; width:90%; max-width:420px; padding:30px 25px;
    border-radius:20px; box-shadow:0 10px 25px rgba(24,119,242,.4);
    text-align:center;
}
h2 { color:#1877f2; margin-bottom:15px; font-weight:700; }
.userName { margin-bottom:20px; font-size:18px; font-weight:600; color:#333; }
.balance {
    text-align:left; background:#f0f2f5; padding:15px; border-radius:12px; margin-bottom:20px;
    font-size:16px;
}
.balance p { margin:8px 0; }
button {
    margin-top:10px; width:100%; padding:12px 0; font-size:16px;
    border:none; border-radius:12px; cursor:pointer;
    background:#1877f2; color:white; font-weight:600;
    transition:background 0.3s ease, transform 0.15s ease;
}
button:hover { background:#145dbf; transform:scale(1.05); }
</style>
</head>
<body>

<div class="container">
    <h2>Portefeuille Crypto</h2>
    <div class="userName" id="userName">Utilisateur: ...</div>

    <div class="balance" id="balanceDiv">
        <p><strong>BTC :</strong> <span id="btc">0</span></p>
        <p><strong>ETH :</strong> <span id="eth">0</span></p>
        <p><strong>USDT :</strong> <span id="usdt">0</span></p>
    </div>

    <button id="depositBtn">Deposit</button>
    <button id="withdrawBtn">Withdraw</button>
    <button id="transferBtn">Transfer</button>
    <button id="dashboardBtn">Dashboard</button>
    <button id="logoutBtn" style="margin-top:15px;">Logout</button>
</div>

<script>
// Config Firebase
const firebaseConfig = {
    apiKey: "AIzaSyAzcnb-eswHt_pDi7tCvcIBzlzejCprJfE",
    authDomain: "mitalky.firebaseapp.com",
    projectId: "mitalky",
    storageBucket: "mitalky.appspot.com",
    messagingSenderId: "753557195623",
    appId: "1:753557195623:web:abc3b37eca5d67c9157dc2"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

const userNameDiv = document.getElementById("userName");

// Vérifier utilisateur connecté
auth.onAuthStateChanged(user=>{
    if(!user){
        window.location.href="login.html";
    } else {
        loadUserInfo(user.uid);
        loadBalance(user.uid);
    }
});

// Charger informations utilisateur
function loadUserInfo(uid){
    db.collection("wallets").doc(uid).get().then(doc=>{
        if(doc.exists){
            const data = doc.data();
            userNameDiv.textContent = "Utilisateur: " + (data.name || auth.currentUser.email);
        } else {
            userNameDiv.textContent = "Utilisateur: " + auth.currentUser.email;
        }
    });
}

// Charger solde
function loadBalance(uid){
    db.collection("wallets").doc(uid).get().then(doc=>{
        const data = doc.exists ? doc.data() : {btc:0,eth:0,usdt:0};
        document.getElementById("btc").innerText = (data.btc || 0).toFixed(4);
        document.getElementById("eth").innerText = (data.eth || 0).toFixed(4);
        document.getElementById("usdt").innerText = (data.usdt || 0).toFixed(2);
    });
}

// Boutons
document.getElementById("depositBtn").addEventListener("click", ()=>{ window.location.href="deposit.html"; });
document.getElementById("withdrawBtn").addEventListener("click", ()=>{ window.location.href="withdraw.html"; });
document.getElementById("transferBtn").addEventListener("click", ()=>{ window.location.href="transfert.html"; });
document.getElementById("dashboardBtn").addEventListener("click", ()=>{ window.location.href="dashboard.html"; });
document.getElementById("logoutBtn").addEventListener("click", ()=>{
    auth.signOut().then(()=>{ window.location.href="login.html"; });
});
</script>

</body>
</html>
